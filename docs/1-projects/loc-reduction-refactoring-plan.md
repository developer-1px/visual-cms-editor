# 코드 라인 수 감소를 위한 리팩토링 보고서 및 태스크

이 문서는 Visual CMS Editor 프로젝트의 전체 코드 라인 수(LOC)를 줄이기 위한 리팩토링 전략과 구체적인 태스크를 제시합니다. LOC 감소는 코드의 가독성, 유지보수성, 그리고 잠재적인 버그 발생 가능성을 줄이는 데 기여합니다.

## 1. 목표

-   코드 중복 제거 및 추상화를 통해 전체 코드 라인 수 감소
-   타입 안정성 강화 및 불필요한 타입 단언 제거로 코드 명확성 증대
-   모듈 간 결합도 낮춰 코드 변경의 파급 효과 최소화
-   더욱 간결하고 표현력 있는 코드 작성

## 2. 주요 LOC 감소 영역 및 전략

이전 `code-refactoring-report.md`에서 식별된 문제점들을 기반으로, 다음 영역에서 LOC 감소를 위한 전략을 적용할 수 있습니다.

### 2.1. `any` 및 `as` 키워드 남용 제거

-   **전략**: `any` 타입을 구체적인 타입으로 대체하고, `as`를 사용한 타입 단언을 타입 가드, 제네릭, 또는 더 정확한 타입 추론을 통해 제거합니다. 이는 불필요한 런타임 검사 로직이나 방어 코드를 줄일 수 있습니다.
-   **LOC 감소 효과**: 타입 정의의 명확화는 불필요한 조건문이나 임시 변수 할당을 줄여 코드를 간결하게 만듭니다.

### 2.2. 명령(Command) 및 플러그인(Plugin) 시스템 복잡성 개선

-   **전략**: `SelectionCommandManager`와 `CommandHandler` 간의 복잡한 상호작용을 단순화하고, 플러그인 시스템의 중복 로직을 추상화합니다. 레지스트리 패턴이나 전략 패턴을 도입하여 `switch` 문이나 `if/else if` 체인을 줄입니다.
-   **LOC 감소 효과**: 중복 코드 제거, 패턴 적용을 통한 로직 단순화로 상당한 LOC 감소를 기대할 수 있습니다.

### 2.3. 코드 중복 제거

-   **전략**: `editorKeymaps.ts`와 `plugins/types/*.ts`에서 반복되는 로직(예: 요소 타입 판단, `selectionManager.isSelected` 호출)을 헬퍼 함수, 유틸리티 모듈, 또는 추상 클래스로 추출하여 재사용합니다.
-   **LOC 감소 효과**: 직접적인 코드 라인 수 감소에 가장 큰 영향을 미칩니다.

### 2.4. `TemplateParser.ts`의 DOM 의존성 개선

-   **전략**: DOM 파싱 로직을 추상화하고, 파싱된 데이터를 직접 DOM 요소로 변환하기보다는 정의된 데이터 모델로 변환하는 방식을 강화합니다. 이는 DOM 조작 코드를 줄이고 데이터 처리 로직을 간결하게 만듭니다.
-   **LOC 감소 효과**: DOM 직접 조작 로직 감소 및 데이터 모델 기반의 선언적 코드 증가로 이어집니다.

### 2.5. 일반적인 코드 간결화 기법 적용

-   **유틸리티 함수/모듈**: 자주 사용되는 로직은 별도의 유틸리티 함수로 분리하여 재사용성을 높입니다.
-   **설정 기반 로직**: 복잡한 조건문 대신 설정 객체나 맵을 사용하여 로직을 데이터화합니다.
-   **함수형 프로그래밍 패턴**: `map`, `filter`, `reduce` 등 고차 함수를 활용하여 반복문이나 조건문을 간결하게 표현합니다.
-   **Svelte/프레임워크 특정 최적화**: Svelte의 반응성 및 컴포넌트 합성 기능을 최대한 활용하여 불필요한 수동 DOM 조작을 피합니다.

## 3. 제안하는 리팩토링 태스크

다음은 LOC 감소를 위한 구체적인 리팩토링 태스크 목록입니다. 각 태스크는 독립적으로 수행 가능하며, 순서대로 진행하는 것을 권장합니다.

### 태스크 1: `any` 및 `as` 키워드 사용 최소화

-   **목표**: `src` 디렉토리 내의 모든 `.ts` 파일에서 `any` 및 `as` 키워드 사용을 검토하고, 가능한 한 구체적인 타입으로 대체하거나 타입 가드를 적용합니다.
-   **세부 작업**: `src` 디렉토리에서 `any` 및 `as`를 검색하여 각 사용 사례를 분석하고, 적절한 타입 정의 또는 타입 가드 로직으로 대체합니다.
-   **예상 영향 파일**: `CommandStore.ts`, `UIExecutor.ts`, `ImageCommandHandler.ts`, `ModelTextCommandHandler.ts`, `RepeatableCommandHandler.ts`, `editorKeymaps.ts`, `TemplateParser.ts`, `ModelBasedPluginManager.ts`, `PluginModel.svelte.ts`, `image.ts`, `link.ts`, `index.ts` (selection), `convention.ts` 등.

### 태스크 2: 명령(Command) 시스템 리팩토링

-   **목표**: `src/lib/core/commands` 디렉토리의 복잡성을 줄이고, `SelectionCommandManager`와 `CommandHandler` 간의 결합도를 낮춥니다.
-   **세부 작업**: 
    -   커맨드 레지스트리 패턴을 도입하여 `SelectionCommandManager`가 핸들러를 직접 관리하는 대신, 커맨드 타입에 따라 핸들러를 조회하도록 변경합니다.
    -   `executeCommand` 내의 `switch` 문을 제거하거나 단순화합니다.
    -   `CommandHandler` 인터페이스를 재검토하고, 각 핸들러의 책임을 명확히 합니다.
-   **예상 영향 파일**: `SelectionCommandManager.ts`, `action-interfaces.ts`, `types.ts`, `handlers/*.ts`.

### 태스크 3: 플러그인(Plugin) 시스템 리팩토링 및 중복 제거

-   **목표**: `src/lib/core/plugins` 디렉토리의 코드 중복을 제거하고, 레거시 코드를 정리하며, 타입 안전성을 강화합니다.
-   **세부 작업**: 
    -   `plugins/types/*.ts`에서 반복되는 `selectionManager.isSelected`와 같은 로직을 공통 유틸리티 함수로 추출합니다.
    -   `EditablePluginManager`와 같은 레거시 코드를 제거하거나, `ModelBasedPluginManager`로 완전히 마이그레이션합니다.
    -   `PluginModel.svelte.ts`에서 `BasePluginModel`의 제네릭 `T` 및 `value` 속성의 타입 안전성을 강화합니다.
-   **예상 영향 파일**: `ModelBasedPluginManager.ts`, `core/manager.ts`, `core/registry.ts`, `types/*.ts`, `models/*.ts`.

### 태스크 4: 키보드 단축키 핸들러 로직 간소화

-   **목표**: `src/lib/keyboard/keymaps/editorKeymaps.ts` 파일 내의 반복적인 요소 타입 판단 및 명령 실행 로직을 간소화합니다.
-   **세부 작업**: 
    -   요소 타입을 기반으로 적절한 명령을 실행하는 헬퍼 함수를 생성하거나, 맵핑 구조를 도입하여 중복 코드를 제거합니다.
    -   단축키 핸들러가 직접 `selectionCommandManager.executeCommand`를 호출하는 대신, 추상화된 함수를 통해 명령을 전달하도록 변경합니다.
-   **예상 영향 파일**: `editorKeymaps.ts`.

### 태스크 5: `TemplateParser.ts` 개선

-   **목표**: `TemplateParser.ts`의 DOM 의존성을 줄이고, 타입 단언을 최소화하며, 파싱 로직을 간결하게 만듭니다.
-   **세부 작업**: 
    -   DOM 파싱 로직을 별도의 모듈로 분리하거나, 타입 가드를 적극적으로 활용하여 안전하게 DOM 요소를 처리합니다.
    -   파싱된 데이터를 직접 DOM 요소로 변환하기보다는, 정의된 데이터 모델로 변환하는 방식을 강화합니다.
-   **예상 영향 파일**: `TemplateParser.ts`.

### 태스크 6: 전반적인 코드 중복 제거 및 유틸리티화

-   **목표**: 프로젝트 전반에서 발견되는 작은 코드 중복을 제거하고, 재사용 가능한 유틸리티 함수로 추출합니다.
-   **세부 작업**: 
    -   `src/lib/utils` 디렉토리를 활용하여 공통 로직을 모듈화합니다.
    -   반복되는 배열/객체 조작, 문자열 처리 등을 간결한 함수형 프로그래밍 패턴으로 대체합니다.

## 4. 기대 효과

이러한 리팩토링 태스크들을 통해 다음과 같은 긍정적인 효과를 기대할 수 있습니다.

-   **코드 라인 수 감소**: 불필요한 코드와 중복을 제거하여 전체 코드베이스의 크기를 줄입니다.
-   **가독성 향상**: 간결하고 명확한 코드는 이해하기 쉽고, 새로운 개발자의 온보딩 시간을 단축시킵니다.
-   **유지보수성 증대**: 변경이 필요한 부분이 명확해지고, 코드 수정의 파급 효과가 줄어들어 유지보수가 용이해집니다.
-   **버그 감소**: 복잡성과 중복이 줄어들면 잠재적인 버그 발생 가능성이 낮아집니다.
-   **성능 개선**: 불필요한 연산이나 DOM 조작을 줄여 애플리케이션 성능을 향상시킬 수 있습니다.

이 보고서와 태스크 목록을 바탕으로 코드 개선 작업을 진행할 수 있습니다.
